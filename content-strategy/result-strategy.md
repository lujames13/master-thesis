# 複雜度分析與實驗規劃 (Refined for Theoretical Simulation)

本文件概述了論文的實驗設計，從耗時的深度學習訓練轉向**理論複雜度分析與 Monte Carlo 模擬**。

## 核心理念
1.  **理論基礎**: 所有結果均源自嚴謹的通訊、計算與共識數學模型。
2.  **模擬導向**: 使用 Python 腳本模擬數萬輪次以產生統計顯著的數據，而非單次耗時的真實執行。
3.  **視覺優先**: 結果設計為多維圖表 (X, Y, Z 軸) 以視覺化呈現趨勢與權衡，避免單調的表格。
4.  **關鍵變數**: **挑戰率 ($p$)** 是核心參數，代表「樂觀效率」與「悲觀安全」之間的權衡。

---

## 一、實驗 1: 通訊可擴展性分析 (Communication Scalability)

**目標**: 證明我們的樂觀機制 ($O(n)$) 在擴展性上顯著優於 FLCoin ($O(n^2)$)，且與 BlockDFL ($O(c^2)$) 相當，但無其安全缺陷。

### 1.1 理論模型
*   **FLCoin (PBFT)**: $Comm_{FLCoin} = M \times (2N^2)$ (全網廣播)
*   **BlockDFL (Committee)**: $Comm_{BlockDFL} = M \times (2c^2 + N)$ (委員會共識 + 廣播)
*   **Ours (Optimistic)**: $Comm_{Ours} = M \times [N + p \times (2N^2 - N)]$
    *   正常情況 ($1-p$): $N$ (僅廣播)
    *   挑戰情況 ($p$): $2N^2$ (退回 PBFT)

### 1.2 圖表設計

#### Chart 1.1: 網路規模擴展性 (Line Chart)
*   **X軸**: 節點數量 ($N$) [10, 20, ..., 100, 200]
*   **Y軸**: 每輪總傳輸數據量 (GB) [Log Scale]
*   **數據系列**:
    1.  FLCoin
    2.  BlockDFL ($c=7$)
    3.  Ours ($p=0.01$)
    4.  Ours ($p=0.05$)
*   **預期洞察**: FLCoin 呈指數增長 ($N^2$)，迅速變得不可行。Ours 呈線性增長 ($N$)，緊貼 BlockDFL。

#### Chart 1.2: 挑戰率對頻寬的影響 (Area Chart)
*   **X軸**: 挑戰率 ($p$) [0.0% 到 10.0%]
*   **Y軸**: 平均通訊開銷 (相對於 FLCoin 的比例)
*   **預期洞察**: 顯示「損益平衡點」，證明在正常運作區間 ($p < 5\%$) 下，我們具有巨大優勢。

---

## 二、實驗 2: 計算與驗證負載 (Computation & Validation)

**目標**: 強調「惰性驗證 (Lazy Verification)」的優勢，大多數節點在樂觀情況下無需驗證。

### 2.1 理論模型
*   **FLCoin**: $Comp_{FLCoin} = N \times C_{verify}$ (全員驗證)
*   **BlockDFL**: $Comp_{BlockDFL} = c \times C_{verify}$ (僅委員會驗證)
*   **Ours**: $Comp_{Ours} = [k + p \times (N-k)] \times C_{verify}$
    *   $k$: 主動監督者數量 (如 3-5)
    *   $p$: 全網驗證的機率

### 2.2 圖表設計

#### Chart 2.1: 計算節省比例 (Bar Chart)
*   **X軸**: 方案 [FLCoin, BlockDFL, Ours ($p=0.01$), Ours ($p=0.05$)]
*   **Y軸**: 每輪平均驗證次數
*   **預期洞察**: FLCoin 是滿格 (100%)。BlockDFL 很低 (~7%)。Ours 更低 (~3-5%)，證明我們是最輕量級的。

#### Chart 2.2: 安全的代價 (Line Chart)
*   **X軸**: 挑戰率 ($p$)
*   **Y軸**: 系統總計算成本
*   **預期洞察**: 平緩的斜率顯示即使偶爾發生挑戰，分攤後的成本依然極低。

---

## 三、實驗 3: 安全性與魯棒性 (Monte Carlo Simulation)

**目標**: 證明 BlockDFL 的概率性安全不足，而我們提供確定性安全 (只要 $k \ge 1$)。

### 3.1 模擬邏輯
*   **BlockDFL**: 從 $N$ 個節點中隨機選 $c$ 個委員。若惡意節點 $f > \frac{1}{3}c$ (或 $\frac{2}{3}c$)，攻擊成功。
*   **Ours**: 攻擊成功僅當 **0** 個誠實節點驗證更新 (即 $k=0$ 或所有監督者皆惡意)。

### 3.2 圖表設計

#### Chart 3.1: 攻擊成功機率 (The "Kill Shot" Chart)
*   **X軸**: 惡意節點比例 ($f$) [10% 到 49%]
*   **Y軸**: 模型被投毒的成功率 (%)
*   **數據系列**:
    1.  BlockDFL ($c=7$)
    2.  BlockDFL ($c=15$)
    3.  Ours ($k \ge 1$) -> **0% 的平直線**
*   **預期洞察**: BlockDFL 的風險隨 $f$ 增加而急劇上升。Ours 保持安全，因為我們不依賴委員會多數決，而是依賴*任意*單一誠實驗證。

#### Chart 3.2: 監督者可靠性 (Heatmap)
*   **X軸**: 總節點數 ($N$)
*   **Y軸**: 惰性率 (節點不驗證的機率)
*   **顏色**: $k=0$ (系統崩潰) 的機率
*   **預期洞察**: 即使 90% 的節點偷懶，系統崩潰機率仍趨近於零 ($0.9^{100} \approx 0$)。

---

## 四、實驗 4: 端到端延遲權衡 (Latency Trade-off)

**目標**: 分析包含「挑戰期」在內的總時間成本。

### 4.1 理論模型
*   $T_{total} = T_{comm} + T_{comp} + T_{consensus}$
*   **Ours**: $T_{Ours} = (1-p) \times T_{fast} + p \times (T_{fast} + T_{challenge} + T_{PBFT})$
    *   $T_{challenge}$: 爭議窗口 (如 5 分鐘)。

### 4.2 圖表設計

#### Chart 4.1: 延遲 vs 挑戰率 (3D Surface or Multi-line)
*   **X軸**: 挑戰率 ($p$)
*   **Y軸**: 模型大小 (MB) [小 CNN 到 大 VGG]
*   **Z軸**: 平均每輪延遲
*   **預期洞察**:
    *   **小模型**: 挑戰期佔比大，高 $p$ 影響顯著。
    *   **大模型**: 傳輸時間佔比大，$p$ 影響微乎其微 (傳輸本身就比挑戰期久)。
    *   **結論**: 本方法特別適合 **LLM** 或大型基礎模型。

---

## 五、綜合比較總結

| 特性 | FLCoin | BlockDFL | Ours |
| :--- | :--- | :--- | :--- |
| **通訊** | $O(N^2)$ (極重) | $O(c^2)$ (輕) | **$O(N)$ (最輕)** |
| **計算** | $100\%$ | $\sim 7\%$ | **$\sim 3-5\%$** |
| **安全** | 確定性 | 概率性 (有風險) | **確定性 (安全)** |
| **延遲** | 高 (傳輸慢) | 低 | **低 (分攤後)** |

---

## 六、關鍵參數調優建議 (針對模擬)

### 6.1 挑戰率 $p$
*   **模擬設定**: 在 $0.001$ 到 $0.1$ 之間掃描。
*   **論述**: 尋找 "Sweet Spot"，即延遲增加不明顯但安全性有保障的區間。

### 6.2 主動監督者 $k$
*   **模擬設定**: 測試 $k=1, 3, 5, 10$。
*   **論述**: 證明 $k=1$ 足以保證安全，但 $k=3$ 提供更好的冗餘，且成本增加可忽略。

---

## 七、實驗實施時間表 (修訂版)

### Phase 1: 腳本開發 (3 天)
*   撰寫 Python 腳本實作上述複雜度公式。
*   撰寫 Monte Carlo 模擬腳本用於安全性測試。

### Phase 2: 數據生成與繪圖 (2 天)
*   運行模擬，導出 CSV 數據。
*   使用 Matplotlib/Seaborn 繪製高品質論文圖表。

### Phase 3: 論文撰寫 (持續)
*   將圖表插入論文，撰寫分析文字。

---

## 八、預期挑戰與解決方案

### 挑戰 1: 模擬過於簡化
*   **問題**: 審稿人可能質疑理論模型未考慮真實網路波動。
*   **解決**: 在公式中加入隨機變數 (Random Variable) $\epsilon$ 來模擬網路抖動 (Jitter)，並在圖表中顯示誤差棒 (Error Bars)。

### 挑戰 2: 參數選擇的主觀性
*   **問題**: 為什麼選 $p=0.01$？
*   **解決**: 不只選一個點，而是畫出 $p$ 的完整曲線 (Chart 1.2, 4.1)，證明在很寬的範圍內我們都有效。

---

## 九、論文呈現建議

*   **避免**: 只有數字的大表格。
*   **採用**: 
    *   **對數座標 (Log Scale)**: 用於通訊對比，因為 $O(N^2)$ 和 $O(N)$ 差距巨大。
    *   **雙Y軸圖 (Dual Y-axis)**: 同時顯示「延遲」和「安全性」隨 $p$ 的變化。
    *   **熱力圖 (Heatmap)**: 用於展示多變數 ($N, p$) 對性能的聯合影響。