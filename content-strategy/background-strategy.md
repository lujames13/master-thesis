# Chapter 2: Background 章節架構規劃 (最終版)

**總頁數預算**: 10-12頁  
**寫作風格**: 教科書式客觀描述,現在式,說明性 (非批判性)

**核心原則**:
- ✅ 只講會用到的技術 (PBFT, Optimistic, 多聚合器, 經濟激勵)
- ✅ 包含算法、公式、推導 (Tutorial級深度)
- ❌ 絕不討論具體研究系統 (FLCoin、opML等留給Ch3)
- ❌ 不做批判性分析 (留給Ch3)

---

## 2.1 聯邦學習基礎 (2頁)

### 2.1.1 聯邦學習定義與數學模型 (1頁)

**Goal**: 建立FL數學框架,介紹多種聚合算法

**Content Outline**:
- 聯邦學習定義 (分散式訓練 + 隱私保護)
- 數學框架: `min_w F(w) = Σ[n_k/n · F_k(w)]`
- FedAvg算法偽代碼 (Algorithm 1)
- **聚合算法多樣性**: FedAvg, FedProx, Krum, Median, Trimmed Mean
  - 強調: 不同算法的計算複雜度和記憶體需求差異顯著
  - 目的: 為Ch3批判「FPVM限制無法支援複雜聚合算法」埋伏筆

**Depth Control**:
- ✅ 完整數學定義 + FedAvg偽代碼
- ✅ 列舉多種聚合算法 (各1句描述)
- ❌ 不討論Non-IID (本研究未涉及)

**Content from**: `research-core-analysis.md`, `framework-design.md` 4.2節

---

### 2.1.2 聚合器的角色與責任 (1頁)

**Goal**: 說明為何需要「多聚合器」和「共識機制」

**Content Outline**:
- 聚合器定義 (收集更新 + 執行聚合算法 + 分發模型)
- **單聚合器問題**: SPOF, 計算瓶頸O(R×K), 安全風險
- **多聚合器動機**: 負載分散R/N, 容錯, 去信任化
- **引出需求**: 多聚合器需要協調機制驗證一致性 → 共識機制

**Depth Control**:
- ✅ 強調「聚合器執行聚合算法」(為計算通用性埋伏筆)
- ❌ 不討論具體多聚合器系統 (FLCoin等)

**Content from**: `framework-design.md` 4.1, `deep_research_1027.md` 2.1.1

---

## 2.2 區塊鏈與智能合約 (2頁)

### 2.2.1 區塊鏈基礎架構 (0.8頁)

**Goal**: 說明區塊鏈如何提供「去中心化信任層」

**Content Outline**:
- 區塊鏈定義 (分散式帳本 + 密碼學鏈接)
- 核心特性: 去中心化, 不可篡改, 透明性, 持久性
- **許可鏈 vs 公有鏈**: 本研究聚焦許可鏈 (聯盟場景)
- 圖2.1: 區塊鏈結構圖

**Depth Control**:
- ✅ 說明基本架構和特性
- ❌ 不深入挖礦/共識細節 (PBFT在2.3詳述)

---

### 2.2.2 智能合約與自動執行 (0.7頁)

**Goal**: 說明智能合約如何自動化協調流程

**Content Outline**:
- 智能合約定義 (自動執行的鏈上程式)
- **應用於FL**: 自動觸發挑戰, 分配獎勵/懲罰, 更新排除清單
- Solidity偽代碼範例 (簡單的submitChallenge函數)

**Depth Control**:
- ✅ 說明自動化能力
- ❌ 不涉及複雜實現 (留給Ch5)

---

### 2.2.3 IPFS與鏈下存儲 (0.5頁)

**Goal**: 說明為何需要鏈下存儲

**Content Outline**:
- IPFS定義 (內容定址的分散式存儲)
- 為何需要: 模型參數大, 上鏈成本高
- 工作流程: 上傳IPFS→獲得CID→CID哈希上鏈→驗證者讀取

**Depth Control**:
- ✅ 說明基本運作
- ❌ 不深入IPFS內部機制

**Content from**: `framework-design.md` 圖4.1, 4.2節

---

## 2.3 拜占庭容錯與PBFT協議 (3-4頁)

### 2.3.1 拜占庭將軍問題 (0.8頁)

**Goal**: 建立拜占庭容錯理論基礎

**Content Outline**:
- 問題描述 (拜占庭將軍比喻, 惡意節點)
- 拜占庭容錯定義 (安全性 + 活性)
- **理論上界**: n ≥ 3f+1 → f < n/3

**引用**: Lamport et al. (1982)

**Depth Control**:
- ✅ 說明 f < n/3 來源
- ❌ 不深入數學證明

---

### 2.3.2 PBFT三階段協議 (1.5頁)

**Goal**: 詳細解釋PBFT運作機制

**Content Outline**:
- 角色定義: Primary, Replicas, View
- **三階段流程**: Pre-prepare, Prepare, Commit (Algorithm 2偽代碼)
- 關鍵機制: 2f+1 Quorum, 數字簽名, 序列號, 視圖切換
- 圖2.2: PBFT消息流程圖

**Depth Control**:
- ✅ 完整偽代碼 + 狀態轉換
- ✅ 解釋2f+1的意義
- ❌ 不涉及視圖切換細節 (簡述即可)

**Content from**: `framework-design.md` 算法3 (PBFT挑戰驗證程序)

---

### 2.3.3 O(n²)通訊複雜度分析 (1頁)

**Goal**: 推導PBFT的O(n²)瓶頸

**Content Outline**:
- **消息數推導**:
  - Phase 1: O(n)
  - Phase 2: n節點廣播 → O(n²)
  - Phase 3: n節點廣播 → O(n²)
  - 總計: O(n²)
- 實證數據: n=100時~10,000條消息
- 可擴展性瓶頸: n>100幾乎不可行

**為何重要**: 這是Ch1/Ch3批判「純PBFT無法擴展」的技術依據

**Depth Control**:
- ✅ 數學推導 + 實證數據
- ❌ 不討論優化方案 (留給Ch3的FLCoin等)

---

### 2.3.4 PBFT安全性保證 (0.7頁)

**Goal**: 說明PBFT的f < n/3容錯能力

**Content Outline**:
- 容錯度: f < n/3
- 安全證明核心: 2f+1 Quorum確保至少f+1誠實節點
- **Quorum交集定理**: 任意兩個Quorum至少有f+1共同節點
- 數學推導: 設n=3f+1, Quorum大小=2f+1, 交集≥f+1

**Depth Control**:
- ✅ 簡潔數學推導
- ❌ 不深入完整證明 (引用文獻)

---

## 2.4 Optimistic執行與挑戰機制 (2頁)

### 2.4.1 Optimistic Rollup概念 (0.8頁)

**Goal**: 解釋「樂觀假設」原理

**Content Outline**:
- 核心思想: 假設誠實, 先接受結果
- 挑戰期設計: 時間窗口允許質疑
- 應用場景: Layer 2擴展 (以太坊Optimism為例)
- **對比表**: 傳統共識 vs Optimistic (驗證時機, 複雜度, 最終性)

**Depth Control**:
- ✅ 說明基本原理
- ❌ 不深入Layer 2技術細節

---

### 2.4.2 欺詐證明與FPVM (0.7頁)

**Goal**: 客觀描述Fraud Proof機制及其技術限制

**Content Outline**:
- Fraud Proof定義 (證明計算錯誤的簡潔證據)
- 交互式挑戰 (二分搜索定位錯誤)
- **FPVM技術限制** (客觀描述, 不批判):
  - 記憶體限制: 典型實現4GB上限
  - 計算環境: 僅支援CPU, 無GPU加速
  - 程式邏輯分解: 複雜演算法 (排序, 距離計算) 分解困難

**為何需要**: 為Ch3批判「opML無法支援Krum等複雜聚合算法」提供技術依據

**Depth Control**:
- ✅ 客觀說明技術限制 (源於FPVM基本要求)
- ✅ 暗示「複雜聚合算法難以在FPVM執行」
- ❌ 不批判opML (留給Ch3)

---

### 2.4.3 挑戰期間與經濟模型 (0.5頁)

**Goal**: 說明經濟激勵如何防止惡意行為

**Content Outline**:
- 質押機制: 提交結果需鎖定代幣
- 獎懲規則: 挑戰成功/失敗的質押損失
- 經濟安全假設: 攻擊成本 > 攻擊收益

**Depth Control**:
- ✅ 說明基本經濟模型
- ❌ 不討論具體參數設計 (留給2.6)

---

## 2.5 多聚合器架構與輪替演算法 (1.5頁)

### 2.5.1 輪替選擇演算法 (0.8頁)

**Goal**: 說明輪替機制如何分散負載

**Content Outline**:
- Round-Robin原理 (公平輪流)
- Algorithm 3: Aggregator Selection偽代碼
  - 輸入: 當前回合r, 聚合器總數N, 排除清單E
  - 邏輯: `a ← (r-1) mod N`, 若在排除清單則跳過
- 複雜度分析: O(1)平均

**Content from**: `framework-design.md` 算法1

**Depth Control**:
- ✅ 完整偽代碼
- ❌ 不討論動態排除細節 (留給Ch4)

---

### 2.5.2 負載分散的數學模型 (0.7頁)

**Goal**: 推導N倍計算負擔降低

**Content Outline**:
- 單聚合器: 每個處理R輪 → O(R×K)
- 多聚合器: 每個處理R/N輪 → O((R/N)×K)
- **效率提升**: 負擔降低N倍
- 公式推導

**Content from**: `research-core-analysis.md` 效率分析

**Depth Control**:
- ✅ 數學推導
- ❌ 不涉及PBFT模式的複雜度 (留給Ch3對比)

---

## 2.6 經濟激勵與質押機制 (1頁)

### 2.6.1 質押要求與懲罰機制 (0.5頁)

**Goal**: 說明質押如何防止惡意行為

**Content Outline**:
- 質押要求: 參與者需鎖定代幣
- Slashing機制: 惡意行為自動扣除
- 懲罰條件: 挑戰成功, 超時, 提交無效數據
- 最小質押公式: `S_min = α × 參與獎勵`, α∈[10,20]

**Depth Control**:
- ✅ 說明基本機制
- ❌ 不深入經濟學模型

---

### 2.6.2 獎勵分配機制 (0.5頁)

**Goal**: 說明如何激勵誠實參與

**Content Outline**:
- 獎勵公式: `Reward = α·DataQuality + β·DataVolume + γ·ComputeCost`
- 挑戰者獎勵: 成功挑戰獲得部分被罰質押
- 長期激勵: 誠實參與累積信譽

**Depth Control**:
- ✅ 說明基本原理
- ❌ 不討論具體參數調優

---

## 頁數分配總結

| 章節 | 頁數 | 優先級 |
|------|------|--------|
| 2.1 聯邦學習基礎 | 2頁 | 🟡 MEDIUM |
| 2.2 區塊鏈與智能合約 | 2頁 | 🟡 MEDIUM |
| 2.3 PBFT協議 | 3-4頁 | 🔴 HIGH |
| 2.4 Optimistic執行 | 2頁 | 🔴 HIGH |
| 2.5 多聚合器架構 | 1.5頁 | 🟡 MEDIUM |
| 2.6 經濟激勵 | 1頁 | 🟢 LOW |
| **總計** | **11.5-12.5頁** | ✅ |

---

## 寫作順序建議

**Phase 1 (核心技術)**:
1. 2.3 PBFT協議 (最複雜, 優先)
2. 2.4 Optimistic執行 (與2.3並行準備)
3. 2.1 聯邦學習基礎 (相對獨立)

**Phase 2 (支撐內容)**:
4. 2.2 區塊鏈基礎
5. 2.5 多聚合器架構
6. 2.6 經濟激勵 (最後補充)

---

## 質量控制檢查清單

**每節完成後必須檢查**:

### 深度控制
- [ ] 是否包含算法偽代碼/數學公式?
- [ ] 複雜度分析是否有推導?
- [ ] 是否避免討論具體研究系統?

### 引用完整性
- [ ] 關鍵概念是否有引用?
- [ ] 是否使用IEEE格式 `[數字]`?
- [ ] Background必須即時添加引用, 不可留TODO

### 邏輯連貫性
- [ ] 每節是否有過渡句?
- [ ] 術語首次出現是否定義?
- [ ] 圖表是否編號並在文中引用?

---

## 與其他章節的邊界

| 內容類型 | Background (Ch2) | Related Work (Ch3) |
|----------|------------------|-------------------|
| PBFT協議 | ✅ 算法原理, O(n²)推導 | ❌ 不涉及 |
| FLCoin系統 | ❌ 完全不提 | ✅ 貢獻+局限+對比 |
| Optimistic概念 | ✅ 樂觀假設, 挑戰期 | ❌ 僅簡單引用 |
| opML系統 | ❌ 完全不提 | ✅ FPVM限制批判 |
| FPVM限制 | ✅ 客觀描述技術約束 | ✅ 批判無法支援複雜算法 |
| 經濟激勵 | ✅ 通用質押機制 | ✅ 具體系統的激勵設計 |

---

## 關鍵成功標準

完成後, Chapter 2應滿足:

✅ 讀者能理解Ch4的「混合Optimistic-PBFT」技術細節  
✅ 為Ch3批判「PBFT的O(n²)瓶頸」和「FPVM限制」提供基礎  
✅ 無任何具體研究系統討論 (FLCoin, opML等)  
✅ 所有核心技術有算法偽代碼或數學推導
