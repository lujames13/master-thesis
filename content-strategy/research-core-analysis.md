# Research Core Analysis

## 研究問題

你的論文旨在解決區塊鏈聯邦學習中 PBFT 共識的效率問題，同時保持計算通用性。傳統 PBFT 方案（如 FLCoin）每次聚合都需要執行共識，通信開銷高且延遲大。而 Optimistic 方案（如 opML）雖然高效，但使用 fraud proof 進行仲裁，受 FPVM 限制，無法支援複雜聚合算法和大型模型。

## 核心創新

### Optimistic PBFT

結合 Optimistic 挑戰期與 PBFT 共識的混合機制

將 Optimistic 驗證的挑戰期理念應用於 PBFT 共識，創造一個兼具效率與計算通用性的聯邦學習驗證架構：

**正常情況（無挑戰）**：聚合者發布結果 → 挑戰期 → 無人挑戰 → 結果確認

- 依賴 1-of-N 假設（至少一個誠實驗證者會發現問題並挑戰）
- 樂觀通過，避免每次都執行昂貴的 PBFT 共識

**異常情況（被挑戰）**：驗證者提出挑戰 → 觸發 PBFT 共識（全體驗證者參與）

- 依賴 M-of-N 假設（>2/3 誠實節點達成共識）
- 驗證者在原生環境重新計算聚合，通過 PBFT 達成共識
- 不使用 fraud proof（關鍵差異），因此無 FPVM 的計算限制

## 關鍵洞察

挑戰期機制不必然要用 fraud proof 來仲裁。本研究證明 PBFT 共識同樣可以作為挑戰期的仲裁機制，從而在保持高效率的同時，獲得計算通用性（支援任意聚合算法和模型規模）。

## 關鍵技術

- **PBFT (Practical Byzantine Fault Tolerance)**: 用於挑戰仲裁階段的共識達成（M-of-N 誠實假設，需要 >2/3 誠實節點）
- **Optimistic Detection**: 用於正常情況的樂觀通過機制（1-of-N 誠實假設，至少一個誠實驗證者會發現並挑戰錯誤）
- **Byzantine 容錯理論**: 支撐威脅檢測與異常節點識別

## 主要對比對象

### FLCoin（傳統 PBFT 方案）
- 每次聚合都執行 PBFT 共識，通信開銷高且延遲大（O(n²) 通信複雜度）

### opML (Optimistic Machine Learning)
- 基於 fraud proof 的樂觀驗證機制，採用鏈下執行 + 挑戰期的模型，依賴 1-of-N 誠實假設
- 使用 FPVM (Fault Proof Virtual Machine) 進行仲裁，受記憶體和計算限制

### zkML (Zero-Knowledge Machine Learning)
- 基於零知識證明的鏈上驗證機制，透過 zk-SNARKs/zk-STARKs 等證明系統提供數學級別的計算完整性保證
- 但需要算術化，計算開銷極高

## 優勢分析

### 0. 多聚合器輪替的計算優勢（相對於傳統 PBFT）

#### 計算負擔分散

傳統 PBFT 方案（如 FLCoin）中，每個驗證者都需要參與每輪聚合的驗證過程：
- **每個驗證者的聚合運算次數**：R 次（R 為總訓練輪數）
- **系統總聚合運算次數**：R × V 次（V 為驗證者數量）

本研究通過多聚合器輪替機制：
- **每個聚合器的聚合運算次數**：R/N 次（N 為聚合器數量）
- **系統總聚合運算次數**：R 次（分散在 N 個聚合器上）
- **計算負擔降低**：每個節點的負擔從 R 次降至 R/N 次，降低 N 倍

**範例**（R=100, N=10）：
- 傳統 PBFT：每個驗證者 100 次聚合運算
- 本研究：每個聚合器 10 次聚合運算
- 計算負擔降低 90%

這種計算負擔的降低使得：
- 可以使用較低配置的硬體（降低成本）
- 支援更複雜的聚合算法（如 Byzantine-robust 算法）
- 支援更大規模的模型（7B-175B 參數）

---

### 1. 效率優勢（相對於傳統 PBFT）—— 主要貢獻

#### 傳統 PBFT 方案的效率問題

傳統 PBFT 方案（如 FLCoin [9]）在每次聚合時都需要執行完整的 PBFT 共識協議，這導致：

**(1) 高通信開銷**

- PBFT 需要 O(n²) 的通信複雜度，其中 n 為驗證者數量
- 每次聚合需要多輪消息交換：Pre-Prepare → Prepare (n 個消息) → Commit (n 個消息)
- 當驗證者數量增加時，通信成本呈平方級增長

**(2) 高延遲**

- 每次聚合都需要等待多輪通信完成（至少 2 輪）
- 需要等待 >2/3 節點響應才能達成共識
- 在網絡延遲較高或節點地理分布廣泛的場景中，延遲更加顯著

**(3) 無差異化處理**

- 無論實際威脅等級如何，每次聚合都執行相同的昂貴協議
- 在低威脅場景下（大多數情況），這種「過度保護」造成資源浪費

#### 本研究的 Optimistic PBFT 優勢

**(1) 樂觀通過機制（正常情況）**

- 無需共識協議：大多數情況下（無挑戰），結果在挑戰期結束後直接確認
- 通信開銷降至 O(1)：聚合者只需發布一次結果，無需多輪消息交換
- 低延遲：只需等待挑戰期（例如幾分鐘），無需等待共識協議的多輪通信

**(2) 按需執行 PBFT（異常情況）**

- 只在被挑戰時才觸發 PBFT 共識
- 假設大多數情況下聚合是誠實的（這在許可鏈/聯盟鏈場景中是合理假設）
- 平均通信開銷遠低於傳統 PBFT

**(3) 效率分析**

設挑戰發生的概率為 p（通常 p << 1）：

**通訊複雜度對比**：
- 傳統 PBFT：每輪通訊開銷 = O(n²) 條消息
- Optimistic PBFT：平均通訊開銷 = O(1) × (1-p) + O(n²) × p ≈ O(1)
- 效率提升：當 p < 0.1 時，通訊開銷降低約 n² 倍

**計算複雜度對比**（假設 R 輪訓練，N 個聚合器）：
- 傳統 PBFT：每個驗證者需執行 R 次聚合運算
- Optimistic PBFT（正常）：每個聚合器需執行 R/N 次聚合運算
- 效率提升：計算負擔分散至 N 個聚合器，每個聚合器負擔降低 N 倍

**(4) 可擴展性優勢**

**通訊維度**：
- 傳統 PBFT 的可擴展性受限於 O(n²) 通訊複雜度，實際部署通常限制在 10-20 個驗證者
- Optimistic PBFT 在正常情況下的 O(1) 通訊開銷，使得系統可以支援更多驗證者而不顯著影響效率

**計算維度**：
- 傳統 PBFT 每個驗證者需執行全部 R 輪聚合
- Optimistic PBFT 通過多聚合器輪替，每個聚合器僅需執行 R/N 輪，大幅降低單節點計算負擔

### 2. 計算通用性優勢（相對於 opML/zkML）—— 次要貢獻

雖然 opML 和 zkML 等方案提供了不同的安全保證和效率權衡，但它們都面臨計算通用性限制，無法支援聯邦學習中的任意聚合操作。

#### opML 的計算限制

opML 使用 fraud proof 進行挑戰仲裁，需要通過 FPVM (Fault Proof Virtual Machine) 重新執行計算 [3]。這導致：

- **記憶體限制**：FPVM 記憶體上限為 4GB，無法載入大型模型
- **複雜邏輯分解困難**：需要將聚合邏輯分解為 VM 指令層級。對於帶正則化的優化問題（如 FedProx）或需要排序/距離計算的算法（如 Krum），分解過程極其複雜甚至不可行
- **無 GPU 加速**：FPVM 必須在 CPU 上模擬執行，無法利用 GPU 加速

#### zkML 的計算限制

zkML 使用零知識證明進行驗證，需要將計算「算術化」(arithmetization) 為算術電路 [1][4]。這導致：

- **模型規模限制**：對 7B+ 參數模型「完全不可行」，實際可驗證上限僅約 18M 參數 [1][2]
- **算法限制**：只能驗證可高效算術化的簡單算法（如 FedAvg），無法處理需要複雜邏輯的 Byzantine-robust 算法（如 Krum、Median、Trimmed Mean）
- **證明開銷**：證明生成「慢數個數量級」，例如 ResNet50 聚合需約 55 分鐘 [8]

#### 本研究的優勢

**關鍵差異**：本研究的挑戰仲裁機制是 PBFT 共識（而非 fraud proof 或零知識證明）

- **驗證者在原生環境執行**：不需要 FPVM，不需要算術化
- **支援任意聚合算法**：包括 FedAvg、FedProx、q-FedAvg、Krum、Median、Trimmed Mean 等任何算法，甚至包括未來提出的新算法
- **支援任意模型規模**：7B-175B 參數的大型語言模型
- **原生框架與 GPU 加速**：可使用完整的 PyTorch/TensorFlow 和 GPU/TPU 環境
- **高效仲裁**：PBFT 共識（分鐘級）遠快於 zkML 的證明生成（數十分鐘到小時級）

**總結**：opML 和 zkML 的方案雖然在信任模型或透明度上有各自的優勢，但在聯邦學習場景中，它們受限於各自驗證機制的計算能力。本研究通過使用 PBFT 作為仲裁機制，在保持樂觀通過效率的同時，實現了對任意聚合操作的支援。

### 3. 雙層安全模型

本研究採用雙層安全模型，結合兩種信任假設的優勢：

#### 第一層：Optimistic 檢測（1-of-N 誠實假設）

- **機制**：聚合者發布結果 → 挑戰期 → 驗證者監控
- **假設**：只要有至少一個誠實驗證者在線並檢查結果，就能發現錯誤並提出挑戰
- **優勢**：大多數情況下（無惡意行為）實現高效率

#### 第二層：PBFT 仲裁（M-of-N 誠實假設）

- **機制**：挑戰觸發 → 全體驗證者重新計算 → PBFT 共識
- **假設**：需要超過 2/3 的驗證者誠實
- **優勢**：當檢測到問題時，提供強安全性保證（Byzantine 容錯）

#### 安全性分析

這種雙層模型提供了「防禦縱深」(Defense in Depth)：

- **正常情況**：依賴 1-of-N 的低成本監控
- **異常情況**：啟動 M-of-N 的強安全仲裁

相比單層模型:

- 比純 Optimistic 更安全（有 PBFT 作為最後防線）
- 比純 PBFT 更高效（大多數情況樂觀通過）

### 4. 方案對比總結

| 方案 | 效率（正常情況） | 計算通用性 | 信任模型 | 適用場景 |
|------|------------------|----------|--------|--------|
| 傳統 PBFT | 低（每次 O(n²)） | 高（原生執行） | M-of-N (>2/3) | 高威脅 + 小規模驗證者 |
| opML | 高（樂觀通過） | 中等（受 FPVM 限制） | 1-of-N | 中大型模型 + 簡單算法 |
| zkML | 低（證明生成慢） | 極低（18M 參數上限） | 數學級信任 | 小模型 + 簡單算法 + 極高信任要求 |
| 本研究 (Optimistic PBFT) | 高（樂觀通過） | 高（原生執行） | 1-of-N + M-of-N（雙層） | 生產環境的通用 FL 應用 |

### 本研究的定位

在聯盟鏈/許可鏈場景中（驗證者集合已知且基礎信任度較高），通過將 Optimistic 挑戰期與 PBFT 共識結合，實現了效率、安全性與計算通用性的最佳平衡，使其適合生產環境的真實聯邦學習應用。

## Key References

本文檔引用的核心文獻：

- [1] Z. Xing et al., "Zero-Knowledge Proof-based Verifiable Decentralized Machine Learning in Communication Network: A Comprehensive Survey," arXiv preprint arXiv:2310.14848, 2023.
- [2] D. Kang, K. Gurkan, and A. Rose, "Scaling up Trustless DNN Inference with Zero-Knowledge Proofs," in Proc. NeurIPS RegulateML Workshop, 2023.
- [3] K. Conway et al., "opML: Optimistic Machine Learning on Blockchain," arXiv preprint arXiv:2401.17555, 2024.
- [4] Z. Peng et al., "A Survey of Zero-Knowledge Proof Based Verifiable Machine Learning," arXiv preprint arXiv:2502.18535, 2025.
- [8] M. Bahrami, "Decentralized Federated Learning on Blockchain using Zero Knowledge Proofs," Tesi Luiss, 2024.
- [9] [FLCoin 相關文獻待補充]

**備註**: 完整的 zkML 研究參考文獻（63 篇）保存於獨立的 zkML 研究報告中，需要時可查閱。