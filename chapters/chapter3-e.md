# III. Related Work

## E. Hybrid Consensus Mechanisms

現有PBFT方法與樂觀驗證方法各有優劣：PBFT提供強安全保證但效率受限於O(n²)通訊複雜度，而樂觀機制雖高效但受限於FPVM等驗證環境的計算能力。為了平衡效率與安全性，部分研究提出混合共識機制，嘗試結合不同技術的優勢。本節回顧兩類主要混合方案：基於Layer架構的分層設計（§E.1）與多階段共識機制（§E.2），並分析其與本研究動態切換機制的差異（§E.3）。

---

### E.1 Layer-based Architectures

Layer架構方案將FL系統分為多個層次，不同層次採用不同的共識機制，藉此在效率與安全性之間取得平衡。

**IEEE 9223754 - Optimistic Rollup on Bitcoin**

IEEE 9223754[TODO]將Optimistic Rollup概念應用於Bitcoin網絡上的聯邦學習。該方案採用雙層架構：Bitcoin作為Layer 1提供安全層，負責最終性確認和爭議仲裁；Rollup作為Layer 2執行層，負責高頻的模型聚合計算。聚合器在Layer 2完成計算後，將結果的默克爾根(Merkle Root)提交至Bitcoin主鏈，並設置挑戰期允許驗證者質疑。若發生爭議，通過Bitcoin的時間戳和不可篡改性進行仲裁。

然而，該方案存在**跨層通訊開銷大**的問題。每次提交狀態根至Bitcoin主鏈都需要支付交易費用並等待區塊確認（平均10分鐘），這在FL訓練的快速迭代場景中造成顯著延遲。此外，Layer分離增加了系統架構的複雜度，需要額外的跨層通訊協議和狀態同步機制。相較之下，本研究在單一鏈上實現Optimistic-PBFT切換，避免了跨層通訊開銷，且在許可鏈環境下區塊確認速度更快（秒級），更適合FL的訓練節奏。

**FLock - State Channels + PBFT**

FLock[TODO]結合狀態通道(State Channels)與PBFT共識，實現快速聚合與安全保證的混合。在訓練過程中，參與者通過鏈下的狀態通道進行高頻互動和模型更新，避免每次聚合都需上鏈的延遲和成本。當訓練階段完成或達到檢查點時，將最終狀態提交至主鏈並執行PBFT共識，確保結果的不可篡改性。這種設計類似於支付通道的閃電網絡(Lightning Network)，在吞吐量上有顯著提升。

然而，狀態通道的管理極為複雜，特別是在**參與者動態變化**的場景下。開啟和關閉通道需要鏈上交易，若訓練過程中有新客戶端加入或退出，需要重新協商通道狀態並重新開啟。此外，狀態通道適用於固定參與者集合的場景，但在FL中客戶端可能因網絡問題或設備狀態變化而頻繁上下線，這使得通道管理成為系統瓶頸。本研究則支援**動態參與者管理**：輪值聚合器的輪換機制天然支援節點的加入和退出，無需複雜的通道重新協商流程。

---

### E.2 Multi-Stage Consensus

多階段共識機制將驗證流程分為多個階段，每階段採用不同的共識算法，試圖結合各自的優勢。

**EPP-BCFL - PoS+BFT兩階段混合**

EPP-BCFL (Enhanced Privacy-Preserving Blockchain-based Federated Learning)[TODO]提出兩階段混合共識機制。第一階段使用權益證明(Proof of Stake, PoS)選擇驗證者，節點根據質押的代幣數量獲得驗證權重，這種機制能有效篩選出有經濟動機維護系統安全的節點。第二階段則在選定的驗證者之間執行拜占庭容錯共識(BFT)，對聚合結果進行驗證，確保即使部分驗證者惡意，系統仍能達成正確共識。該方案的目標是結合PoS的效率（避免全網參與驗證）與BFT的安全性（Byzantine容錯保證）。

然而，EPP-BCFL採用的是**固定兩階段執行流程**，無論當前輪次是否存在實際威脅，系統都必須執行完整的PoS選擇和BFT驗證。這造成兩個主要問題：

**(1) 非威脅感知的冗餘開銷**

在絕大多數正常情況下（假設99%聚合器誠實），系統仍需執行完整的BFT驗證流程。每輪訓練都需要驗證者之間的多輪消息交換（Pre-Prepare、Prepare、Commit階段），即使聚合結果完全正確且無人質疑。這與BlockDFL的「每輪都驗證」問題類似，造成計算資源的浪費。實驗數據顯示，在100個驗證者的場景下，每輪BFT共識需要約5秒，訓練100輪則累積約500秒(8.3分鐘)的純驗證開銷[TODO]。

**(2) 缺乏動態調整能力**

EPP-BCFL的兩階段流程是靜態配置的，無法根據實時安全狀況動態調整驗證強度。例如：
- 在訓練初期（威脅較低時），仍需執行完整BFT驗證
- 在訓練後期（模型接近收斂，潛在攻擊收益增加時），驗證強度無法相應提升
- 若發現高頻異常，系統無法自動增加驗證者數量或縮短驗證周期

相較之下，本研究提出的**動態Optimistic-PBFT機制**具有以下差異：

| 維度 | EPP-BCFL (靜態兩階段) | 本研究 (動態切換) |
|------|----------------------|------------------|
| 驗證觸發 | 每輪固定執行 | 僅在挑戰時觸發 |
| 威脅感知 | ❌ 無威脅感知 | ✅ 基於挑戰率動態調整 |
| 正常情況開銷 | O(n²) BFT | O(R/N) 輪值聚合 |
| 異常情況安全 | BFT (f<n/3) | PBFT (f<n/3) + 挑戰機制 |
| 參數自適應 | ❌ 固定參數 | ✅ 挑戰率閾值自適應 |

本研究的核心哲學是**「樂觀優先，按需強化」**：在正常情況下（無挑戰），系統以O(R/N)效率運行，僅輪值聚合器執行計算；當檢測到威脅（挑戰發生）時，立即切換至PBFT全網驗證模式，提供f<n/3的Byzantine容錯保證。這種動態切換機制相較於EPP-BCFL的固定兩階段流程，能更有效地利用計算資源，僅在真正需要時才啟動重驗證。

---

### E.3 Summary: Static Hybrid vs. Dynamic Adaptive

現有混合共識方案在架構設計上取得了一定的平衡，但仍採用**靜態混合策略**，存在以下共同局限：

**(1) 固定的Layer分離或階段劃分**

無論是IEEE 9223754的Layer 1/Layer 2架構，還是EPP-BCFL的PoS+BFT兩階段流程，這些方案都預先定義了系統的結構和執行流程。一旦部署，系統無法根據實時威脅自動調整驗證策略。例如，在長期無攻擊的場景下，系統仍需執行完整的驗證流程；而在高威脅時期，驗證強度也無法相應提升。

**(2) 缺乏動態威脅感知機制**

這些方案缺乏對實時安全狀況的感知能力，無法區分「正常輪次」與「異常輪次」。系統不會根據歷史挑戰頻率、聚合器行為模式或模型收斂階段等因素動態調整驗證強度。這導致資源分配的低效：在低威脅時過度驗證，在高威脅時可能驗證不足。

**(3) 效率與安全的靜態權衡**

現有混合方案在設計時就固定了效率與安全的權衡點。例如，FLock選擇「大部分時間在鏈下，定期上鏈結算」；EPP-BCFL選擇「每輪都執行BFT但限制驗證者數量」。這些靜態權衡無法適應FL訓練過程中威脅等級的動態變化。

**本研究的創新：威脅感知的動態混合機制**

本研究提出的Optimistic-PBFT機制實現了真正的**動態自適應混合**：

- **威脅感知觸發**：基於挑戰事件自動切換驗證模式，而非固定執行
- **自適應參數調整**：根據挑戰率歷史動態調整安全參數（如挑戰期長度、PBFT參與者數量）
- **平滑模式切換**：從樂觀執行(O(R/N))到PBFT驗證(O(n²))的無縫切換，無需系統重啟或架構重組

這種設計理念的核心是：**安全機制應該像免疫系統一樣，平時保持低耗能狀態，遇到威脅時自動啟動強防禦**。相較於現有混合方案的「始終保持固定警戒等級」，本研究的動態機制能更有效地平衡長期運行FL系統的效率與安全需求。

**過渡至F節（Research Gap）**：儘管混合方案嘗試平衡效率與安全，但上述分析顯示，現有技術路線仍存在三大核心缺口：委員會方法的長期安全脆弱性（§B）、純PBFT的計算冗餘性（§B）、以及樂觀/零知識方法的運算限制（§C-D）。這些缺口為動態威脅感知的混合共識機制留下研究空間，具體將在下一節（§F）總結並定位本研究的貢獻。
