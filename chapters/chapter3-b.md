# III. Related Work (續)

## B. PBFT-based Multi-Aggregator Verification

### B.1 Committee-based PBFT Approaches

#### B.1.1 FLCoin: Sliding Window Committee

**核心機制介紹**

FLCoin[TODO]採用滑動窗口委員會（Sliding Window Committee）設計，僅c個節點（通常c=100）參與驗證，將PBFT通訊複雜度從O(n²)降至O(c)。系統設計快速協議（3階段）與備用協議（5階段）以平衡效率與安全性。

**性能數據**

FLCoin的委員會設計顯著降低通訊複雜度。傳統全員PBFT需要O(n²)訊息交換（n為所有驗證者數量），而FLCoin將複雜度降至O(3c)到O(5c)之間（取決於使用快速或備用協議）。實驗結果顯示，在100個節點的網路中，快速協議可在5秒內完成共識，遠優於全員PBFT的數十秒延遲[TODO]。安全性方面，在模擬的拜占庭攻擊場景下（20%惡意節點），FLCoin達到98.4%的成功率，證明委員會機制在一定程度上可容忍惡意行為[TODO]。

**批判點1：信任機制的長期脆弱性**

然而，FLCoin的滑動窗口與聲譽機制在短期實驗中雖然有效，但在長期運行場景（如醫療聯邦學習訓練可能持續數月甚至數年、金融風控模型需持續更新）面臨**潛伏攻擊（Sleeper Attack）**的根本性威脅。

**(1) 信任積累悖論**

攻擊者可在前t輪訓練中保持完全誠實行為，持續提交正確的聚合結果、積極參與驗證、遵守所有協議規範。這種長期的「良好行為」會使其聲譽評分持續上升，最終獲得進入委員會的資格。諷刺的是，聲譽系統原本設計用於過濾惡意節點，卻反而成為攻擊者的「保護傘」：一旦建立高聲譽，攻擊者即可在關鍵時刻（如第t+1輪）利用委員會成員身份發動攻擊，而其高聲譽使得其他節點難以察覺異常。在長期FL訓練場景中，這種潛伏期可長達數月，攻擊者有充足時間建立信任。

**(2) 滑動窗口的有限記憶**

滑動窗口機制雖然能週期性更新委員會，但窗口大小有限（通常為100-200輪訓練），這意味著系統僅能「記憶」最近窗口內的行為。攻擊者只需確保在滑動窗口內的行為誠實，窗口之外的異常行為會被系統「遺忘」。更嚴重的是，若攻擊者採取間歇性攻擊策略（每k輪發動一次小規模攻擊，k > 窗口大小），系統無法關聯這些分散的惡意行為，每次攻擊在窗口內都顯得像是「偶發異常」而非蓄意攻擊。在持續數年的FL訓練中（如醫療診斷模型需累積大量病例數據），有限記憶窗口無法提供長期安全保障。

**(3) 委員會局部驗證的盲區**

FLCoin的驗證僅在委員會c個節點內進行，非委員會成員無法參與驗證過程，也無法對委員會決議進行交叉檢查（Cross-check）。這產生嚴重的安全盲區：若攻擊者控制委員會多數成員（超過c/3），他們可以通過內部共謀達成惡意共識，例如集體接受一個錯誤的聚合結果。外部節點僅能看到「委員會已達成共識」的最終結果，無法察覺委員會內部的串謀。這種局部驗證架構在長期運行下，給予攻擊者充足時間滲透委員會（通過潛伏建立聲譽），最終實現內部控制。

**綜合而言，這些局限的根本原因是FLCoin將信任機制作為唯一安全保障，缺少密碼學共識作為後備。**在長期運行場景下，攻擊者可通過(1)建立高聲譽、(2)利用有限記憶窗口、(3)滲透委員會三步驟形成完整的潛伏攻擊路徑，而系統缺乏強制性的密碼學驗證來阻止此類攻擊。

**批判點2：固定窗口的剛性**

FLCoin的委員會規模c與窗口大小皆為靜態配置，無法根據實時威脅等級動態調整。在低威脅環境下（如所有節點行為正常），固定的c=100仍然產生不必要的驗證開銷——相較於更小的委員會或甚至樂觀執行模式，系統浪費計算與通訊資源在過度驗證上。反之，在高威脅環境下（如檢測到異常行為模式），固定規模可能不足以提供足夠的安全裕度；理想情況下應擴大委員會規模或啟動全員驗證，但FLCoin缺乏此類自適應機制。這種剛性配置使系統無法在效率與安全間動態平衡，始終維持中等水平的驗證強度。

**對比本研究**

本研究與FLCoin的根本差異在於驗證觸發機制與安全保障層級。FLCoin依賴固定委員會的信任機制，而本研究採用**威脅感知的混合機制**：

- **挑戰者範圍**：FLCoin僅委員會c個成員參與驗證；本研究允許**任意驗證者**發起挑戰，避免委員會內部共謀的盲區。
- **驗證機制**：FLCoin依賴聲譽系統過濾惡意節點；本研究在挑戰觸發時啟動**全網PBFT共識**，提供密碼學級別的正確性保證（f < n/3），而非依賴信任積累。
- **長期安全**：FLCoin的滑動窗口與聲譽機制在長期運行下易受潛伏攻擊；本研究的PBFT驗證提供**無關歷史行為的即時安全保障**——無論攻擊者過去聲譽多高，一旦提交錯誤結果並被挑戰，需面對全網拜占庭容錯驗證。

值得強調的是，本研究並非否定信任機制的價值（見B.1.3節），而是主張信任機制應作為效率優化手段，而**密碼學共識應作為安全底線**。


#### B.1.2 Other Committee-based Approaches

**VFChain：雙委員會架構**

VFChain[TODO]採用雙委員會架構嘗試強化安全性：**驗證委員會（Verification Committee）**負責檢查聚合結果的正確性，**共識委員會（Consensus Committee）**負責對驗證結果達成共識並上鏈。此設計的動機是職責分離：驗證與共識由不同節點集合執行，降低單一委員會被攻陷的風險。然而，VFChain本質上仍是靜態配置的委員會機制，面臨與FLCoin相同的潛伏攻擊風險——攻擊者可同時滲透兩個委員會。更嚴重的是，雙委員會架構增加系統複雜度（需協調兩層委員會）與通訊開銷（兩輪委員會互動），但並未從根本上解決信任機制的長期脆弱性問題。系統仍然依賴委員會成員的誠實假設，缺乏強制性的密碼學驗證作為後備機制。

**MCFLM-CB：延遲分組機制**

MCFLM-CB[TODO]提出根據節點網路延遲進行分組的委員會選擇策略。系統將驗證者按延遲分為多個組別（如低延遲組、中延遲組、高延遲組），優先從低延遲組選擇委員會成員，以降低共識延遲。此機制確實能提升共識效率，特別是在地理分散的FL場景中。然而，延遲分組策略本身仍是固定的，且仍依賴聲譽機制評估節點誠實度。攻擊者若部署低延遲節點（如使用高頻寬數據中心），更容易被選入委員會，反而增加攻擊面。更根本的問題是，MCFLM-CB與FLCoin一樣，面臨潛伏攻擊威脅：攻擊者可在低延遲組內長期保持誠實，建立聲譽後發動攻擊。系統缺乏動態威脅感知與強制驗證機制。

**小結**

委員會方法的共同局限在於**靜態安全策略**：無論是FLCoin的滑動窗口、VFChain的雙委員會、或MCFLM-CB的延遲分組，皆採用預先配置的委員會結構與固定的驗證流程。這些方案的核心假設是「信任機制能有效過濾惡意節點」，然而在長期運行場景下，此假設面臨潛伏攻擊的挑戰。信任機制確實有其價值——在正常情況下能顯著提升效率，避免不必要的全員驗證開銷。但若將信任機制作為**唯一**的安全保障，系統在長期運行下極為脆弱。真正的安全需要密碼學共識（如PBFT）作為**不可妥協的後備機制**，在檢測到威脅時提供強制性的正確性保證。


#### B.1.3 Positioning: Trust vs. Cryptographic Consensus

本研究並非否定信任機制與聲譽系統的價值。相反，這些機制在日常運作中能有效提升效率——在大多數訓練輪次中，聚合器確實誠實執行計算，此時若仍執行全員PBFT驗證，會產生不必要的計算與通訊開銷。聲譽系統能快速過濾明顯的惡意行為，委員會機制能將驗證範圍限縮至可管理規模，這些設計在實踐中確有其合理性。

然而，在長期運行的生產環境FL系統中（如醫療診斷模型訓練可能持續數年、金融風控模型需持續累積新數據），**潛伏攻擊是不可忽視的現實威脅**。攻擊者有充足時間與動機建立信任、滲透委員會、選擇最佳攻擊時機。若系統僅依賴信任機制，一旦攻擊發生，缺乏強制性的驗證手段來阻止惡意結果上鏈。這在高風險應用場景（如醫療、金融）中是不可接受的安全風險。

因此，本研究的定位是**信任但驗證（Trust but Verify）**：

- **正常情況（樂觀模式）**：假設聚合器誠實，樂觀接受結果，利用信任機制與輪值制度提供O(R/N)的高效率（R為訓練輪數，N為聚合器數量）。此時系統行為類似委員會方法，享受效率優勢。

- **異常情況（驗證模式）**：一旦任意驗證者檢測到可疑行為並發起挑戰，系統立即啟動**全網PBFT共識**，提供f < n/3的拜占庭容錯保證。此時密碼學共識取代信任機制，成為安全的最後防線。

- **核心哲學**：信任機制是效率優化手段，密碼學共識是安全底線。兩者互補而非互斥。系統應在大多數情況下樂觀運行，但必須保留強驗證能力以應對極端情況。

這種混合機制的關鍵在於**動態觸發**而非靜態配置。委員會方法預先決定驗證範圍與流程，無法根據實時威脅調整；本研究根據挑戰事件動態決定是否啟動PBFT，實現效率與安全的自適應平衡。


---

### B.2 Full PBFT Verification Approaches

#### B.2.1 BlockDFL: Per-Round PBFT Verification

**核心機制介紹**

BlockDFL[TODO]採用完全去中心化的點對點（Peer-to-Peer, P2P）架構，移除傳統FL的中央化聚合器。在此架構下，每個參與節點既是客戶端（上傳模型更新）也是驗證者（驗證聚合結果）。每輪訓練結束後，所有驗證者執行完整的PBFT共識協議來驗證聚合結果的正確性。系統結合異常檢測機制（Anomaly Detection）與PBFT投票：驗證者首先獨立重新計算聚合結果，若發現與提議結果不符，則在PBFT投票階段拒絕簽名；只有獲得超過2/3驗證者簽名的結果才能被接受並寫入區塊鏈。

BlockDFL的設計哲學是「全透明、全驗證」：所有計算過程公開，所有驗證者參與，無需信任任何單一實體。此架構在理論上提供最強的安全保障——只要誠實節點超過2/3，系統即可抵禦任意拜占庭攻擊。

**性能數據**

實驗結果顯示，BlockDFL能容忍高達40%的惡意節點比例，遠超傳統PBFT的33%理論上限（實驗可能採用特定攻擊模型或額外防禦機制）[TODO]。然而，全員PBFT驗證帶來沉重的通訊負擔：每輪訓練需要O(V²)訊息交換（V為驗證者數量）。在V=100的網路中，每輪共識需約10,000條訊息；若V=1000，訊息數量暴增至1,000,000條。實驗顯示，在100節點網路中，每輪PBFT共識耗時約數分鐘[TODO]，隨節點數增加，延遲呈超線性增長。

**批判點1：計算冗餘性**

BlockDFL的「每輪都驗證」策略提供強安全性,但存在嚴重的**計算冗餘問題**：

**(1) 威脅無關的固定開銷**

無論當前訓練輪次是否存在實際威脅（如所有聚合器誠實執行計算），系統仍然強制要求全體驗證者參與PBFT共識。每個驗證者都需重複執行相同的聚合計算（如對1000個客戶端的梯度進行加權平均），然後進行O(V²)訊息交換以達成共識。在大多數情況下，這些計算與通訊開銷是不必要的——若聚合器本就誠實，驗證僅是在確認「已知正確」的結果。隨訓練輪數R增長，總計算開銷累積為O(R × V²)，在長期訓練場景中（如訓練100輪、1000輪甚至更多）造成巨大資源浪費。

**(2) 參與者越多越冗餘**

PBFT的O(V²)複雜度使得驗證開銷隨驗證者數量平方增長。在100個驗證者的網路中，每輪需約10,000次訊息傳遞與簽名驗證；若擴展至1000個驗證者，開銷暴增至1,000,000次——100倍的參與者導致10,000倍的驗證開銷。這種超線性增長使得BlockDFL在大規模FL場景中（如跨機構醫療聯邦學習可能涉及數百家醫院）幾乎不可行。諷刺的是，聯邦學習的初衷之一是分散式協作，但BlockDFL的全員驗證機制反而限制系統規模。

**(3) 無效率優化路徑**

BlockDFL缺乏樂觀執行模式或動態驗證強度調整機制。系統無法利用「大多數情況下聚合器誠實」這一實際特性——在生產環境FL中，惡意攻擊是低頻事件而非常態。理想情況下，系統應在正常時期降低驗證開銷，僅在檢測到可疑行為時才啟動全員PBFT。然而BlockDFL採用靜態的「每輪全驗證」策略，將大量資源浪費在過度驗證上。這不僅增加計算成本（每個驗證者的CPU/GPU資源）與通訊成本（網路頻寬），也延長訓練總時長，降低FL系統的實用性。

**批判點2：缺乏動態調整**

BlockDFL對所有訓練輪次採用相同的驗證流程，無法根據實際威脅等級動態調整驗證強度。在低威脅場景下（如所有節點行為正常、歷史記錄良好），系統仍執行全員PBFT，產生不必要開銷；在高威脅場景下（如檢測到異常行為模式），系統亦無法進一步強化驗證（例如增加共識輪次或啟動額外審計機制）。這種「一刀切」的驗證策略使系統無法在效率與安全間自適應平衡，始終維持高成本的最大安全強度。

**對比本研究**

本研究與BlockDFL的核心差異在於**驗證觸發機制**：

- **樂觀情況**：本研究採用輪值聚合器（Round-Robin Aggregator）機制，每輪僅一個聚合器執行計算，效率為O(R/N)（N為聚合器數量）。相較BlockDFL的每輪O(V²)全員驗證，在正常情況下效率提升數個數量級。

- **異常情況**：本研究並非完全放棄驗證，而是**按需觸發PBFT**。當任意驗證者檢測到可疑結果並發起挑戰時，系統才啟動全網PBFT共識。此設計使得驗證開銷與實際威脅頻率相關，而非固定發生。

- **動態調整**：本研究可根據挑戰頻率自適應調整驗證強度。若某時期挑戰頻繁（暗示高威脅環境），可縮短挑戰期或降低挑戰門檻，提升安全性；若長期無挑戰（低威脅環境），可延長挑戰期以進一步優化效率。

BlockDFL提供的「無條件安全」確實有其價值，但在實際部署中，**適應性安全（Adaptive Security）**比「最大化安全」更為實用。


#### B.2.2 Other Full PBFT Approaches

**IEEE 9223754：Bitcoin上的PBFT FL**

IEEE 9223754標準提案[TODO]探討在Bitcoin網路上實現PBFT驗證的聯邦學習系統。其核心思想是利用Bitcoin區塊鏈的時間戳服務（Timestamping）與不可篡改性（Immutability）作為安全基礎層，在此之上運行PBFT共識以驗證聚合結果。此設計的優勢在於繼承Bitcoin的強安全性與廣泛節點分佈；然而，其仍然採用每輪執行PBFT的策略，無法避免O(n²)通訊瓶頸。更嚴重的是,Bitcoin區塊鏈的10分鐘出塊時間與有限吞吐量（約7 TPS）使得FL訓練延遲進一步增加——每輪訓練不僅需等待PBFT共識（數分鐘），還需等待結果上鏈（10分鐘），總延遲可達15分鐘以上。這在需要快速迭代的FL場景中（如即時推薦系統、動態風控模型）幾乎不可接受。

**傳統PBFT在FL的應用**

Castro與Liskov於1999年提出的原始PBFT協議[7]包含三階段流程：Pre-Prepare（主節點提議）、Prepare（節點準備投票）、Commit（節點提交決議）。多個研究直接將此協議套用於FL聚合驗證：聚合器扮演主節點提議聚合結果，驗證者執行Prepare與Commit階段以達成共識[TODO]。此直接套用方式的優勢是實現簡單、理論成熟；然而,其面臨PBFT固有的可擴展性問題。實驗顯示，當驗證者數量n超過100時，共識延遲急劇上升（從數秒增至數分鐘），網路頻寬消耗呈平方增長；當n > 500時，系統幾乎無法運作[TODO]。這使得傳統PBFT僅適用於小規模、私有聯盟鏈場景，無法支援大規模跨機構FL。

**小結**

純PBFT方案（BlockDFL、IEEE 9223754、傳統PBFT直接應用）的共同問題是**缺乏樂觀執行模式**。這些方案提供強大的安全性——只要誠實節點超過2/3，即可抵禦任意拜占庭攻擊。然而，「每輪必驗證」的策略忽略了實際FL場景的威脅特性：惡意攻擊是低頻事件，大多數訓練輪次中聚合器誠實執行計算。在此前提下，全員PBFT驗證產生巨大的計算與通訊冗餘，且系統無法根據實時威脅動態調整驗證強度。

這留下關鍵的研究缺口：**能否在保持PBFT拜占庭容錯安全性的同時，引入樂觀執行機制以提升正常情況下的效率？**本研究的Optimistic-PBFT混合機制正是對此問題的回應。


#### B.2.3 Summary: The Efficiency-Security Dilemma

現有PBFT-based方案面臨兩難困境：

- **委員會方法**（FLCoin、VFChain、MCFLM-CB）：通過限縮驗證範圍（僅委員會c個節點）降低通訊複雜度至O(c)，效率大幅提升。然而，為實現委員會選擇，這些方案引入信任機制（聲譽系統、質押機制），在長期運行下面臨潛伏攻擊風險。攻擊者可建立信任、滲透委員會、發動內部共謀，而系統缺乏強制性的全網驗證作為後備。

- **純PBFT方法**（BlockDFL、IEEE 9223754、傳統PBFT）：要求全員參與驗證，提供f < n/3的強安全保證，無需任何信任假設。然而，O(n²)通訊複雜度與「每輪必驗證」策略導致嚴重的計算冗餘，系統無法擴展至大規模場景，也無法利用正常情況下的效率優化機會。

**核心缺口**：

1. **缺乏動態威脅感知機制**：無論委員會或全員PBFT，皆採用靜態驗證策略，無法根據實時威脅調整驗證強度。

2. **缺乏樂觀執行與拜占庭容錯的平滑切換**：系統要麼始終信任（委員會方法），要麼始終驗證（全員PBFT），缺乏「正常時信任、異常時驗證」的動態機制。

3. **固定驗證策略無法適應實時威脅變化**：實際FL場景中威脅是動態的，但現有方案的驗證流程是靜態配置的，無法自適應。

本研究通過**Optimistic-PBFT混合機制**尋求突破此困境：在樂觀情況下採用輪值制度保持O(R/N)效率，在挑戰觸發時啟動全網PBFT提供f < n/3安全保證，實現效率與安全的動態平衡。具體機制將在第IV章詳述。
